# Deploying ACS Hardware

This page will provide a generalized guide for deploying new ACS hardware, including identifying the ideal switch type, setting parameters, etc.

Make sure to also check out the "Example ACS Deployments" page for inspiration.

## Determining Switch Type

One of the major benefits of the SHED's ACS design is the different switch types available. This enables integration with more complex equipment and in ways that are more compatible with tempermental devices.

Things to Consider:

* **DO NOT DISABLE EMERGENCY STOPS, LIMIT SWITCHES, INTERLOCKS, ETC**
    * Ex: If a CNC router has a wireless pendant that connects to a USB receiver, do not use a USB Hub Switch to disable this receiver if there's an emergency stop button on the pendant.
* Do not cut power to only a portion of the equipment's control electronics that may cause it to respond in an unknown way.
    * Ex: Cutting power to a CNC's controller but not the motor drivers may cause the motors to act unpredictibly.
    * The opposite is fine though, since random commands from the controller can't move unpowered motors.
* If your Switch wiring interfaces with a safety component like an emergency stop, it should be wired in **series**, and in a way that the Switch doesn't impact the operation of the emergency stop during normal use. 
* How does a device deal with an abrupt power-off?
    * Ex: Suddenly cutting power to a ProtoTrak controller causers it to lose all data such as coordinates, tool tables, etc.
    * Ex: Epilog lasers need to go through a 60-second startup every time you turn power back on.
    * If a device doesn't handle power-off well, may not be ideal for an AC Power Switch, Contactor Switch, etc.
    * How does the device deal with power-on as well?
        * Ex: Laguna belt sanders have a power switch instead of a button. So, if it was left on when someone removed their card, the machine immediately starts spinning when a new card is inserted.
* Are there easily accessible control wires or interfaces?
    * Ex: Many Laguna bandsaws have a low-current control switch on the front door, that cuts power to the motor, with easy-to-access wires for a Contactor Switch.
    * Ex: Haas CNC controllers have a screw terminal for an auxiliary emergency stop connection.
* What's the current draw of the device (if considering interrupting power)?
    * See "ACS Switches" page for maximum ratings.

When are certain switches best?

* AC Power Switch
    * 115V devices with current draw <15A
    * Device responds well to being powered off abruptly (like simple power tools).
    * No easily accessible control interfaces.
* Contactor Switch
    * Mains-voltage control loop to low-current interlocks, switches, etc.
    * Equipment already has an integrated contactor for main power.
    * Device is very high-power and there are no control interfaces (install your own contactor + Contactor Switch).
* Signal Relay Switch
    * Device has low-voltage/very low-current control signals that can be interrupted (like an Emergency Stop).
    * There is a source of power nearby for the Switch.
* USB Hub Switch
    * Device uses USB for its primary control interface.
    * Loading files via USB is required for the equipment to be used.
    * Device is powered via USB and draws under 500mA.
    * No emergency stops run via USB.

## ACS Configuration

ACS hardware can be configured over USB via serial. 

To begin, connect the ACS Core to a computer and open a serial terminal. Software like PUTTY or the Arduino IDE are reccomended. The device name will be "CH340C" or "Generic USB UART Bridge" for hardware V2.3.2. Baud rate will be 115200.

Parameters are modified by sending a serialized JSON file to the ACS Core. The Core will restart after applying the new settings. The specific order of the JSON parameters don't matter, and you can disclude any parameters you are not changing to keep the last/old settings.

The format of the JSON is as follows:

> {"Parameter1":"Value1","Parameter2":"Value2",..."ParameterX":"ValueX"}

An improperly formatted JSON will result in an error.

The following parameters are accepted (Case Sensitive):

* OldPassword: **The only mandated parameter!**, The parameter protection password. Default value is "Shlug". Entering an incorrect password will result in an error and your settings not being applied.
    * If the incorrect password is entered too many times in a row, the memory will be wiped as a safety feature.
* NewPassword: Sets a new updated password.
* SSID: The name of the WiFi network to connect to.
* Password: The password to access the WiFi network. Set to "null" (case sensitive) to use no password.
* Server: The root server to make API calls against. Ex: https://make.rit.edu.
* Key: The API access key generated by the server.
* MachineID: Unique machine identifier or name. Needs to be formatted with characters that can be in a URL (e.g. "Bandsaw Left" wouldn't work, "bandsawleft" is fine). The system takes any input and will not do error checking.
* MachineType: The numerical machine type, can be found on the website under "Manage Equipment".
* SwitchType: The numerical switch type, used for checking system integrity. Not currently used.
* Zone: The numerical zone/room the equipment is in, can be found on the website under "Rooms".
* NeedsWelcome: Set to 1 to require user has signed in today before using this machine, 0 to not require.
* TempLimit: The temperature threshold, in whole-number degrees Celsius, above which the system enters a fault if detected. 50 is the default, but can be set as high as 80.
* NetworkMode: Not currently used.
* Frequency: How often, in seconds, the system sends a status update to the server. Around 10 (seconds) is default.
* DebugMode: Set to 1 to turn on verbose serial outputs. **WARNING: Debug outputs can contain sensitive information!**
* NoBuzzer: Set to 1 to turn off the buzzer.

There are 2 additional parameters that can be passed that do different things;

* Dump: Will dump the contents of the memory.
    * If the firmware was built with the configuration "DumpKey" to 0, the key will not be dumped with this.
* WipeAll: Will reformat the entire memory.